#!/bin/bash

################################################################################
###                                                                          ###
###     Print executed commands to standard out and stop on failures         ###
###                                                                          ###
################################################################################
set -e;
set -x;
reset;clear;


################################################################################
###                                                                          ###
###     Variables for image naming and execution                             ###
###                                                                          ###
################################################################################
runningContainerName=todo-list-application
containerSourcePort=80
hostTargetPort=28088
containerName=softwareshinobi/todo-list-web-application
containerTag=latest


################################################################################
###                                                                          ###
###     Build the image                                                      ###
###                                                                          ###
################################################################################
docker build -t $containerName:$containerTag .


################################################################################
###                                                                          ###
###     List the Images                                                      ###
###                                                                          ###
################################################################################
docker image ls


################################################################################
###                                                                          ###
###     List the running Containers (before)                                 ###
###                                                                          ###
################################################################################
docker ps


################################################################################
###                                                                          ###
###     Stop and remove the application specific Container                   ###
###                                                                          ###
################################################################################
docker stop $runningContainerName || true
docker rm   $runningContainerName || true

################################################################################
###                                                                          ###
###     Run the container given the parameters specified above               ###
###                                                                          ###
################################################################################
docker run -d --name $runningContainerName         \
           -p $hostTargetPort:$containerSourcePort \
              $containerName:$containerTag


################################################################################
###                                                                          ###
###     List the running Containers (after)                                  ###
###                                                                          ###
################################################################################
echo
docker ps
echo


################################################################################
###                                                                          ###
###     Open the application in the Firefox browser                          ###
###                                                                          ###
###                                                                          ###
################################################################################
firefox http://localhost:$hostTargetPort 2>&1


################################################################################
###                                                                          ###
###     Complete local deployment                                            ###
###                                                                          ###
################################################################################
echo "##########################################################################"
echo "###                                                                    ###"
echo "###     Complete local deployment                                      ###"
echo "###                                                                    ###"
echo "##########################################################################"
exit
